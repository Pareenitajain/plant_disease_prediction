<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Report | Plant Disease AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .result-image {
            width: 100%;
            height: 380px;
            object-fit: cover;
            border-radius: 24px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-elevated);
        }
    </style>
</head>

<body>
    <div class="app-container">
        <div class="container result-container fade-in">
            <div class="header" style="margin-bottom: 40px; text-align: center;">
                <h1>ðŸŒ¿ Diagnosis Report</h1>
                <p class="subtitle">Personalized health insights for your crops.</p>
            </div>

            {% if image_path %}
            <img src="{{ url_for('static', filename='uploads/' + image_path) }}" alt="Analyzed Crop"
                class="result-image">
            {% endif %}

            <div class="prediction-box">
                <p
                    style="color: rgba(255,255,255,0.8); margin-bottom: 10px; font-weight: 500; font-size: 0.9rem; letter-spacing: 1px;">
                    IDENTIFIED CONDITION</p>
                <div class="disease-name" style="color: var(--white);">{{ disease_info.name }}</div>
                <div class="confidence-badge">
                    <i class="fas fa-check-circle"></i> AI Confidence: {{ confidence }}%
                </div>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-info-circle"></i> Condition Overview</h3>
                <p style="margin: 0; font-size: 1.05rem;">{{ disease_info.description }}</p>
            </div>

            <!-- Interactive Action Buttons -->
            <div class="result-actions-grid">
                <button class="action-card-btn" onclick="toggleSection('medicineSection')">
                    <i class="fas fa-prescription-bottle-alt"></i>
                    <h4>Medicines</h4>
                </button>
                <button class="action-card-btn" onclick="toggleSection('storeSection')">
                    <i class="fas fa-map-marker-alt"></i>
                    <h4>Nearest Stores</h4>
                </button>
            </div>

            <!-- Medicines Section -->
            <div id="medicineSection" class="interactive-section info-section">
                <h3><i class="fas fa-mortar-pestle"></i> Recommended Treatments</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 30px;">
                    {% for medicine in disease_info.medicines %}
                    <span class="medicine-tag">{{ medicine }}</span>
                    {% endfor %}
                </div>

                <div class="treatment-grid">
                    <div class="treatment-card">
                        <h5 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-flask"></i> Chemical
                            Control</h5>
                        <ul style="list-style: none; padding: 0; font-size: 0.95rem;">
                            {% for t in disease_info.treatments.chemical %}
                            <li style="margin-bottom: 8px;">â€¢ {{ t }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="treatment-card" style="border-top-color: var(--secondary);">
                        <h5 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-leaf"></i> Organic
                            Remedy</h5>
                        <ul style="list-style: none; padding: 0; font-size: 0.95rem;">
                            {% for t in disease_info.treatments.organic %}
                            <li style="margin-bottom: 8px;">â€¢ {{ t }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Stores Section -->
            <div id="storeSection" class="interactive-section info-section">
                <h3><i class="fas fa-store"></i> Supply Locator</h3>
                <p>Scan for licensed agricultural stores and supply centers near you.</p>
                <button onclick="findNearbyStores()"
                    style="background: var(--text-dark); margin-top: 25px; width: auto;">
                    <i class="fas fa-search-location"></i> Find Stores Nearby
                </button>
                <div id="storeResults" style="margin-top: 25px;"></div>
            </div>

            <div style="display: flex; gap: 20px; margin-top: 50px;">
                <a href="{{ url_for('upload') }}" class="btn" style="text-decoration: none; flex: 2;"><i
                        class="fas fa-camera"></i> Scan Another Plant</a>
                <a href="{{ url_for('logout') }}" class="btn-secondary"
                    style="text-decoration: none; flex: 1; border-radius: 16px; display: flex; align-items: center; justify-content: center;">Logout</a>
            </div>
        </div>
    </div>

    <script>
        function toggleSection(sectionId) {
            const sections = document.querySelectorAll('.interactive-section');
            const target = document.getElementById(sectionId);

            sections.forEach(s => {
                if (s.id !== sectionId) s.classList.remove('active');
            });

            target.classList.toggle('active');
            if (target.classList.contains('active')) {
                setTimeout(() => {
                    target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function findNearbyStores() {
            const resultsDiv = document.getElementById('storeResults');
            resultsDiv.innerHTML = '<div style="color: var(--primary);"><i class="fas fa-spinner fa-spin"></i> Geolocation in progress...</div>';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const mapsUrl = `https://www.google.com/maps/search/agricultural+pesticide+store/@${lat},${lon},13z`;
                    resultsDiv.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Local stores detected!
                            <a href="${mapsUrl}" target="_blank" style="margin-left: auto; color: inherit; font-weight: 700;">Open Map</a>
                        </div>`;
                }, function (error) {
                    resultsDiv.innerHTML = '<div class="alert alert-error"><i class="fas fa-exclamation-triangle"></i> Location access denied.</div>';
                });
            } else {
                resultsDiv.innerHTML = '<div class="alert alert-error">Your browser does not support Geolocation.</div>';
            }
        }
    </script>
</body>

</html>